---
layout: default
permalink: /ja/texts/standard-ml/answers//Ch16.S2.html
translated: true
lang: ja
head: |
 <!--Generated on Sat Nov  6 10:29:27 2021 by LaTeXML (version 0.8.5) http://dlmf.nist.gov/LaTeXML/.-->
 <!--Document created on 2021年11月5日.-->
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <link rel="stylesheet" href="LaTeXML.css" type="text/css">
 <link rel="stylesheet" href="ltx-book.css" type="text/css">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=MML_CHTML" type="text/javascript"></script>
 <link rel="up" href="Ch16.html" title="第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="up up" href="Pt2.html" title="Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="up up up" href="./" title="プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="start" href="./" title="プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="prev" href="Ch16.html" title="第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="next" href="Ch16.S3.html" title="16.3 書式付き書き出し処理 ‣ 第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="section" href="Ch16.S3.html" title="16.3 書式付き書き出し処理 ‣ 第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="chapter" href="Ch12.html" title="第 12 章 基本ライブラリの利用法 ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="chapter" href="Ch13.html" title="第 13 章 配列を用いたプログラミング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="chapter" href="Ch14.html" title="第 14 章 システム時計の利用 ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="chapter" href="Ch15.html" title="第 15 章 入出力処理 ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="chapter" href="Ch16.html" title="第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="chapter" href="Ch17.html" title="第 17 章 OSとのインターフェイス ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="part" href="Pt1.html" title="Part I Standard ML言語 ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
 <link rel="part" href="Pt2.html" title="Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)">
---
{% raw %}
<div class="ltx_page_main">
<header class="ltx_page_header"><div class="ltx_document_title">プログラミング言語 Standard ML 入門 (問題の解答例)</div>
<div>
<a href="Ch16.html" title="第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)" class="ltx_ref" rel="up"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">16 </span>データのフォーマッティング</span></a><a href="Ch16.html" title="第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">16 </span>データのフォーマッティング</span></a><a href="Ch16.S3.html" title="16.3 書式付き書き出し処理 ‣ 第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">16.3 </span>書式付き書き出し処理</span></a>
</div></header>
<div class="ltx_page_content">
<section class="ltx_section ltx_authors_1line">
<h1 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">16.2 </span>文字列からのデータの読み込み</h1>

<div id="Ch16.Thmex1" class="ltx_theorem ltx_theorem_ex">
<h6 class="ltx_title ltx_runin ltx_title_theorem"><span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">問 16.1</span></span></h6>
<div id="Ch16.Thmex1.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">getc</span> が <span class="ltx_text ltx_font_typewriter">(char, substring) reader</span> 型を持つことを確かめよ．
<span class="ltx_text ltx_font_italic"></span></p>
</div>
</div>
<div id="p1" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">解答例 </span>
<span class="ltx_text ltx_font_typewriter">Substring.getc</span>の型は
<span class="ltx_text ltx_font_typewriter">substring -&gt; (char * substring) option</span>
である。
一方
<span class="ltx_text ltx_font_typewriter">(’a, ’b) reader</span>は<span class="ltx_text ltx_font_typewriter">’b -&gt; (’a * ’b) option</span>
であるから、
<span class="ltx_text ltx_font_typewriter">substring -&gt; (char * substring) option</span>は、
<span class="ltx_text ltx_font_typewriter">(char, substring) reader</span>である。</p>
</div>
<div id="Ch16.Thmex2" class="ltx_theorem ltx_theorem_ex">
<h6 class="ltx_title ltx_runin ltx_title_theorem"><span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">問 16.2</span></span></h6>
<div id="Ch16.Thmex2.p1" class="ltx_para">
<p class="ltx_p">上記の関数を使用して，空白で区切られた数字データの文字列を受け取り，
呼び出されるごとに，そのデータから数字を1つずつ読み出す関数を返す関数
<br class="ltx_break"></p>
<pre class="ltx_verbatim ltx_font_typewriter">
   readInt : string -&gt; unit -&gt; int option
</pre>
<br class="ltx_break">
<p class="ltx_p">を定義せよ．
たとえば
<br class="ltx_break">
<span class="ltx_tabular">
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_typewriter">val f = readInt "123 345 abc";</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_italic">val f = fn : unit <span class="ltx_text ltx_font_typewriter ltx_font_upright">-&gt;</span> int option</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_typewriter">- f ();</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_italic">val it = SOME 123 : int option</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_typewriter">- f();</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_italic">val it = SOME 345 : int option</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_typewriter">- f();</span></span></span>
<span class="ltx_tr">
<span class="ltx_td ltx_align_left"><span class="ltx_text ltx_font_italic">val it = NONE : int option</span></span></span>
</span> 
<br class="ltx_break">のような振る舞いをする．
<span class="ltx_text ltx_font_italic"></span></p>
</div>
</div>
<div id="p2" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">解答例 </span>
教科書にある<span class="ltx_text ltx_font_typewriter">decScan</span>と<span class="ltx_text ltx_font_typewriter">intScan</span>の定義も含めた
コード例を以下に示す。</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   fun decScan x = Int.scan StringCvt.DEC x;
   val intScan = decScan Substring.getc
   fun readInt string =
     let
       val stream = ref (Substring.full string)
     in
       fn () =&gt;
         case intScan (!stream) of
           SOME (i, substring) =&gt;
           SOME i before stream := substring
         | NONE =&gt; NONE
    end
</pre>
</div>
<div id="Ch16.Thmex3" class="ltx_theorem ltx_theorem_ex">
<h6 class="ltx_title ltx_runin ltx_title_theorem"><span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">問 16.3</span></span></h6>
<div id="Ch16.Thmex3.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">real</span> 型および <span class="ltx_text ltx_font_typewriter">bool</span> 型に対してもそれぞれ以下の型を持つ関数が定義
されている．</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   Real.scan : (char,’a) reader -&gt; (real,’a) reader
   Bool.scan : (char,’a) reader -&gt; (bool,’a) reader
</pre>
<p class="ltx_p">これらを用いて，<span class="ltx_text ltx_font_typewriter">ReadInt</span> と同様の読み込み関数 <span class="ltx_text ltx_font_typewriter">readReal</span> および
<span class="ltx_text ltx_font_typewriter">readBool</span> を定義せよ．
<span class="ltx_text ltx_font_italic"></span></p>
</div>
</div>
<div id="p3" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">解答例 </span>
コード例を以下にしめす。
これら関数はすべて同型であるため、以下の例では、
高階の関数を定義し、それを各型の<span class="ltx_text ltx_font_typewriter">scan</span>関数に適用している。</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   fun makeRead scan string =
     let
       val reader = scan Substring.getc
       val stream = ref (Substring.full string)
     in
       fn () =&gt;
         case reader (!stream) of
           SOME (i, substring) =&gt;
           SOME i before stream := substring
         | NONE =&gt; NONE
    end
   val readReal = makeRead Real.scan
   val readBool = makeRead Bool.scan
</pre>
<p class="ltx_p">以下はテスト実行例である。</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   # val f = readReal "1.2 3E10 abc";
   val f = fn : unit -&gt; real option
   # f ();
   val it = SOME 1.2 : real option
   # f ();
   val it = SOME 30000000000.0 : real option
   # f ();
   val it = NONE : real option
   # val f = readBool "true false abc";
   val f = fn : unit -&gt; bool option
   # f ();
   val it = SOME true : bool option
   # f ();
   val it = SOME false : bool option
   # f ();
   val it = NONE : bool option
</pre>
</div>
<div id="Ch16.Thmex4" class="ltx_theorem ltx_theorem_ex">
<h6 class="ltx_title ltx_runin ltx_title_theorem"><span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">問 16.4</span></span></h6>
<div id="Ch16.Thmex4.p1" class="ltx_para">
<p class="ltx_p">上記の各種の <span class="ltx_text ltx_font_typewriter">scan</span> 関数は，対応するリーダに適用すれば<span class="ltx_text ltx_font_typewriter">substring</span>型以外のストリームデータに対してもそのまま使用することができる．
これら種々のストリームに使用することができる以下の型を持つ汎用の
読み込み関数</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   genericReadInt : (char,’a) reader -&gt; ’a -&gt; unit -&gt; int option
</pre>
<p class="ltx_p">を書け．
<span class="ltx_text ltx_font_italic"></span></p>
</div>
</div>
<div id="p4" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">解答例 </span></p>
<pre class="ltx_verbatim ltx_font_typewriter">
   fun genericReadInt baseReader baseData =
     let
       val stream = ref baseData
       val reader = Int.scan StringCvt.DEC baseReader
     in
       fn () =&gt;
          case reader (!stream) of
            SOME (i, data) =&gt;
            SOME i before stream := data
          | NONE =&gt; NONE
     end
</pre>
<p class="ltx_p">例えば、以下のように使用できる。</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   # fun readIntFromString string = genericReadInt Substring.getc (Substring.full string);
   val readIntFromString = fn : string -&gt; unit -&gt; int option
   # val f = readIntFromString  "123 456 abc";
   val f = fn : unit -&gt; int option
   # f ();
   val it = SOME 123 : int option
   # f ();
   val it = SOME 456 : int option
   # f ();
   val it = NONE : int option
</pre>
</div>
<div id="Ch16.Thmex5" class="ltx_theorem ltx_theorem_ex">
<h6 class="ltx_title ltx_runin ltx_title_theorem"><span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">問 16.5</span></span></h6>
<div id="Ch16.Thmex5.p1" class="ltx_para">
<p class="ltx_p">ファイルの入力ストリームを受け取り，
入力ストリームから数字データを1つずつ読み出す関数を返す関数</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   readIntFromStream : TextIO.instream -&gt; unit -&gt; int option
</pre>
<p class="ltx_p">を<span class="ltx_text ltx_font_typewriter">genericReadInt</span> を使って定義せよ．
<span class="ltx_text ltx_font_typewriter">genericReadInt</span> を使い，空白で区切られた数字列を内容とする
ファイル名を受け取り，ファイル内の各数字列を <span class="ltx_text ltx_font_typewriter">int</span> 型データに変換し，
そのリストを返す関数</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   readIntFromFile : string -&gt; int list
</pre>
<p class="ltx_p">を書け．
<span class="ltx_text ltx_font_italic"></span></p>
</div>
</div>
<div id="p5" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">解答例 </span>
<span class="ltx_text ltx_font_typewriter">TextIO.StreamIO.input1</span>が、
<span class="ltx_text ltx_font_typewriter">(char, TextIO.StreamIO.instream) reader</span>
を持つので、この関数を使って、以下のように定義できる。</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   fun readIntFromStream ins =
     let
       val stream = TextIO.getInstream ins
     in
       genericReadInt TextIO.StreamIO.input1 stream
     end
</pre>
</div>
<div id="p6" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">readIntFromFile</span>の定義例を以下に示す。</p>
<pre class="ltx_verbatim ltx_font_typewriter">
   fun readIntFromFile file =
     let
       val ins = TextIO.openIn file
       val reader = readIntFromStream ins
       fun loop L =
           case  reader () of
             SOME i =&gt; loop (L @ [i])
           | NONE =&gt;  L
     in
       loop nil before TextIO.closeIn ins
     end
</pre>
</div>
<div id="Ch16.Thmex6" class="ltx_theorem ltx_theorem_ex">
<h6 class="ltx_title ltx_runin ltx_title_theorem"><span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">問 16.6</span></span></h6>
<div id="Ch16.Thmex6.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">parseHttp</span> を参考にして，
ローカルファイルシステムのファイルパスを表すURLの解析処理関数 <span class="ltx_text ltx_font_typewriter">parseFile</span>，およびスキーマ指定のない相対アドレス解析処理関数 <span class="ltx_text ltx_font_typewriter">parseRelative</span> を書き <span class="ltx_text ltx_font_typewriter">ParseUrl</span> モジュールを完成せよ．
<span class="ltx_text ltx_font_italic"></span></p>
</div>
</div>
<div id="p7" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">解答例 </span></p>
<pre class="ltx_verbatim ltx_font_typewriter">
   structure ParseURL =
   struct
   local
     structure SS = Substring
   in
     exception urlFormat
     datatype url
       = HTTP of {host : string list, path : string list option,
                  anchor : string option}
       | FILE of {path : string list, anchor : string option}
       | RELATIVE of {path : string list, anchor : string option}
     fun parseHttp s =
         let val s = if SS.isPrefix "://" s then
                       SS.triml 3 s
                     else raise urlFormat
             fun neq c x = not (x = c)
             fun eq c x = c = x
             val (host,body) = SS.splitl (neq #"/") s
             val domain = map SS.string (SS.tokens (eq #".") host)
             val (path,anchor) =
                 if SS.isEmpty body then (NONE,NONE)
                 else
                   let val (p,a) = SS.splitl (neq #"#") body
                   in (SOME (map SS.string (SS.tokens (eq #"/") p)),
                       if SS.isEmpty a then NONE
                       else SOME (SS.string (SS.triml 1 a)))
                   end
         in {host=domain, path=path, anchor=anchor}
         end
     fun parseRelative s =
         let val (path,anchor) =
                 let val (p,a) = SS.splitl (fn #"#" =&gt; false | _ =&gt; true) s
                 in (map SS.string (SS.fields (fn c =&gt; c = #"/") p),
                  if SS.isEmpty a then NONE else SOME (SS.string (SS.triml 1 a)))
              end
         in {path=path, anchor=anchor}
         end
     fun parseFile s =
         let val s = if SS.isPrefix ":/" s then SS.triml 2 s else raise urlFormat
             val (path,anchor) =
                 let val (p,a) = SS.splitl (fn #"#" =&gt; false | _ =&gt; true) s
                 in (map SS.string (SS.tokens (fn c =&gt; c = #"/") p),
                    if SS.isEmpty a then NONE else SOME (SS.string (SS.triml 1 a)))
                 end
         in  {path=path,anchor=anchor}
         end
     fun parseUrl s =
         let val s = SS.full s
             val (scheme,body) = SS.splitl (fn c =&gt; not (c = #":")) s
         in
           if SS.isEmpty body then
              RELATIVE (parseRelative scheme)
           else case SS.string scheme of
                  "http" =&gt; HTTP (parseHttp body)
                | "file" =&gt; FILE (parseFile body)
                | _  =&gt; raise urlFormat
         end
   end
   end
</pre>
</div>
</section>
</div>
<footer class="ltx_page_footer">
<div>
<a href="Ch16.html" title="第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">16 </span>データのフォーマッティング</span></a><a href="Ch16.S3.html" title="16.3 書式付き書き出し処理 ‣ 第 16 章 データのフォーマッティング ‣ Part II Standard ML基本ライブラリ ‣ プログラミング言語 Standard ML 入門 (問題の解答例)" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">16.3 </span>書式付き書き出し処理</span></a>
</div>
<div class="ltx_page_logo">Generated  on Sat Nov  6 10:29:27 2021 by <a href="http://dlmf.nist.gov/LaTeXML/">LaTeXML <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="[LOGO]"></a>
</div></footer>
</div>
{% endraw %}
